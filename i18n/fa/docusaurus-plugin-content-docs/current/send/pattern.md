# ارسال پیامک با الگو (پترن)

این API به شما امکان ارسال پیامک با استفاده از الگو یا همان پترن را می‌دهد.

این نوع ارسال تنها ارسالی است که نیاز به بازبینی توسط تیم مانیتورینگ نداشته و بلافاصله بعد از درخواست ارسال میگردد.

برای ارسال پیامک هایی که نیاز دارید به سرعت دلیور شوند مانند ارسال رمز یک بار مصرف حتما از این نوع ارسال استفاده نمایید.

## 📍 لینک دسترسی

```
POST {base_url}/api/send
```

## 🧾 هدرها

| کلید          | مقدار               |
|---------------|---------------------|
| Authorization | توکن یا کلید دسترسی |
| Content-Type  | application/json    |

## 📤 بدنه درخواست

```json
{
  "sending_type": "pattern",
  "from_number": "+983000505",
  "code": "xxxxxxxxxxxxxxx",
  "recipients": [
    "+989120000000"
  ],
  "params": {
    "code": "متن جایگذاری"
  },
  "phonebook": {
    "id": 1234,
    "name": "سعید محمدی",
    "pre": "mr",
    "email": "saeed@gmail.com",
    "options": {
      "456": "1970/01/01"
    }
  }
}
```

## 📝 پارامترها

| پارامتر      | نوع    | ضروری | توضیحات                                                                                                                                               |
|--------------|--------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------|
| sending_type | string | بله   | نوع ارسال، باید "pattern" باشد                                                                                                                        |
| from_number  | string | بله   | شماره فرستنده در فرمت E.164 (مثال: +983000505)                                                                                                        |
| code         | string | بله   | کد الگو که قبلا ایجاد کرده اید و میخواهید از آن استفاده کنید                                                                                          |
| recipients   | array  | بله   | شماره تلفن گیرنده در فرمت E.164 (مثال: +989120000000). فقط یک گیرنده برای این نوع ارسال مجاز است.                                                     |
| params       | object | بله   | شی شامل پارامترهای جایگزین در الگو. کلیدها باید با جای‌گذارها در الگو مطابقت داشته باشند.اگر الگوی شما متغیر ندارد این آبجکت به صورت خالی ارسال گردد. |
| phonebook    | object | خیر   | اطلاعات مخاطب برای افزودن به دفترچه تلفن                                                                                                              |
| send_time    | string | خیر   | زمان مورد نظر برای ارسال پیام در فرمت YYYY-MM-DD HH:MM:SS. منطقه زمانی UTC است.                                                                       |

## 📝 شی دفترچه تلفن (اختیاری)

| پارامتر | نوع    | توضیحات                                                                                  |
|---------|--------|------------------------------------------------------------------------------------------|
| id      | number | شناسه دفترچه تلفن مورد نظر                                                               |
| name    | string | نام مخاطب                                                                                |
| pre     | string | پیشوند (mr، mrs، و غیره)                                                                 |
| email   | string | آدرس ایمیل                                                                               |
| options | object | گزینه‌های اضافی (تاریخ تولد و غیره) کلید های آرایه باید مطابق با آیدی خصوصیت مد نظر باشد |

## 📝 نکات

- `from_number` باید سرشماره معتبری باشد که به حساب شما اختصاص یافته است.
- کد الگو باید از قبل در سیستم تعریف شده باشد.
- پارامترهای `params` باید دقیقاً با جای‌گذارهای تعریف شده در الگو مطابقت داشته باشند.
- فقط یک گیرنده برای هر درخواست الگو مجاز است.
- اگر مقدار `phonebook` ارسال شده باشد علاوه بر ارسال پیامک به مخاطب، شماره وی نیز در دفترچه تلفن ذخیره خواهد شد
- اگر دفترچه تلفن مورد نظر به تعداد حداکثر شماره مجاز جهت ذخیره سازی(100 هزار شماره) رسیده باشد، صرفا ارسال انجام خواهد
  شد و شماره گیرنده در مخاطبین درج نمیگردد

## ✅ پاسخ موفق

```json
{
  "data": {
    "message_outbox_ids": [
      1123544244
    ]
  },
  "meta": {
    "status": true,
    "message": "انجام شد",
    "message_parameters": [],
    "message_code": "200-1"
  }
}
```

## ❌ پاسخ خطا — الگو یافت نشد (404)

```json
{
  "data": null,
  "meta": {
    "status": false,
    "message": "الگو یافت نشد",
    "message_parameters": [],
    "message_code": "404-1",
    "errors": {}
  }
}
```

## 🧪 مثال درخواست

```bash
curl --location '{base_url}/api/send' \
--header 'Content-Type: application/json' \
--header 'Authorization: API TOKEN' \
--data '{
    "sending_type": "pattern",
    "from_number": "+983000505",
    "code": "xxxxxxxxxxxxxxx",
    "recipients": [
        "+989120000000"
    ],
    "params": {
        "code": "متن جایگذاری"
    }
}'
```
