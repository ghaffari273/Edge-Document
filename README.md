# 📌 API Documentation
## 📚 Table of Contents

> Base URL: `{base_url}`  
(لطفاً `{base_url}` را با آدرس اصلی سرور جایگزین کنید.)

---

## 📚 Table of Contents

- [🔐 Auth](#-auth)
    - [Login API](#login-api)
    - [Send SMS OTP](#send-sms-otp)
    - [Confirm OTP Login](#confirm-otp-login)
    - [Forgot Password](#forgot-password)
        - [Request Otp For Change Password](#request-otp-for-change-password)
        - [Change Password By Token](#change-password-by-token)
    - [Logout](#logout)
    - [Check Token](#check-token)
- [📦 Package](#-package)
- [📊 Report](#-report)
- [💳 Payment](#-payment)
- [📞 Numbers](#-numbers)
- [📁 Phonebook](#-phonebook)
- [🏦 Bank](#-bank)
- [📝 Draft](#-draft)



> Base URL: `{base_url}`  
(لطفاً `{base_url}` را با آدرس اصلی سرور جایگزین کنید.)

---
# 🔐 Auth
## Login API

Authenticates the user and initiates the login process.

### 📍 Endpoint
POST {base_url}/api/acl/auth/login

### 🧾 Headers

| Key           | Value                |
|---------------|----------------------|
| Content-Type  | application/json     |

### 📤 Request Body
```json
{
  "username": "your-username",
  "password": "your-password"
}
```
### ✅ Success Response
```
{
  "data": {
    "method": "ga", // or "sms" or "login"
    "token": "84cd3ef65b0700dea4ac7942e61df4a5"
  },
  "meta": {
    "status": true,
    "message": "انجام شد",
    "message_parameters": [],
    "message_code": "200-1"
  }
}

```

📌 Method Values
### 🔄 method Meaning (Login Flow Explanation)
Depending on the user's 2FA (Two-Factor Authentication) settings, one of the following scenarios will occur after a successful login:

1- **Google Authenticator (ga)**
If the user has enabled Google Authenticator in their profile settings, the response will contain:

```json
{
  "method": "ga"
}
```

✅ The user must call the [Confirm OTP Login](#-confirm-otp-login) API with the 6-digit code generated by the Google Authenticator app.


2- **SMS OTP (sms)**
If Google Authenticator is not enabled, the system will automatically send an OTP via SMS and the response will contain:
```json
{
  "method": "sms"
}
```
✅ The user must call the [Confirm OTP Login](#-confirm-otp-login) API with the OTP code received via SMS.

⚠️ If the user does not receive the SMS, they can call the [Send SMS OTP](#-send-sms-otp) API to resend the OTP.

3- **No 2FA (login)**
If 2FA is not required for the user, the response will contain:
```json
{
  "method": "login"
}
```
✅ The returned token is final and can be used directly for authenticated API requests. No further action is needed.


⚠️ The temporary token received in the login response:

* _is valid for 6 minutes if method is ga or sms._
* _is valid for 10 hours if method is login._

### ❌ Error Response — Invalid Credentials (401)

```
{
  "data": null,
  "meta": {
    "status": false,
    "message": "اطلاعات وارد شده صحیح نمی باشد",
    "message_parameters": [],
    "message_code": "400-1",
    "errors": {}
  }
}
```
### ❌ Error Response — Validation Error (422)

```
{
  "data": null,
  "meta": {
    "status": false,
    "message": "تکمیل گزینه گذرواژه الزامی است",
    "message_parameters": [],
    "message_code": "400-2",
    "errors": {
      "password": [
        "تکمیل گزینه گذرواژه الزامی است"
      ]
    }
  }
}
```

### 🧪 Example using curl

```
curl --location '{base_url}/api/acl/auth/login' \
--header 'Content-Type: application/json' \
--data-raw '{
  "username": "your-username",
  "password": "your-password"
}'
```

## Send SMS OTP

This endpoint allows the user to request an OTP (One-Time Password) via SMS, using the token received in the login step.

### 📍 Endpoint
POST {base_url}/api/acl/auth/send_sms_otp


### 🧾 Headers

| Key           | Value                |
|---------------|----------------------|
| Content-Type  | application/json     |

### 📤 Request Body
```json
{
  "token": "your-login-step-token"
}
```

### ✅ Success Response

```
{
  "data": {
    "method": "sms",
    "token": "e7aff6e9136cc43e9a7c3c3eae5678ac"
  },
  "meta": {
    "status": true,
    "message": "انجام شد",
    "message_parameters": [],
    "message_code": "200-1"
  }
}
```
⚠️ The token used here must be a temporary login token received from the login API.
If valid and not expired, an OTP will be sent via SMS.


### ❌ Error Response — Invalid or Expired Token (401)

```
{
  "data": null,
  "meta": {
    "status": false,
    "message": "اطلاعات وارد شده صحیح نمی باشد",
    "message_parameters": [],
    "message_code": "400-1",
    "errors": {}
  }
}
```

### 🧪 Example using curl

```
curl --location '{base_url}/api/acl/auth/send_sms_otp' \
--header 'Content-Type: application/json' \
--data '{
  "token": "your-login-step-token"
}'
```

## Confirm OTP Login

This endpoint is used to confirm the login process by verifying the OTP (from SMS or Google Authenticator).

### 📍 Endpoint
POST {base_url}/api/acl/auth/confirm_otp

### 🧾 Headers

| Key           | Value                |
|---------------|----------------------|
| Content-Type  | application/json     |

### 📤 Request Body
```json
{
  "token": "your-temporary-token",
  "otp": "otp-code"
}
```

token: The temporary token received from the Login API

otp: The OTP received via SMS or generated from Google Authenticator

### ✅ Success Response

```
{
  "data": {
    "token": "22c392ffebe7286ee8021cfef7d7cad5",
    "method": "login"
  },
  "meta": {
    "status": true,
    "message": "انجام شد",
    "message_parameters": [],
    "message_code": "200-1"
  }
}
```

🎉 The returned token is the final token that can be used to access authorized APIs.

⏱ Valid for: 10 hours

### ❌ Error Response — Invalid or Expired Token or OTP (401)

```
{
  "data": null,
  "meta": {
    "status": false,
    "message": "اطلاعات وارد شده صحیح نمی باشد",
    "message_parameters": [],
    "message_code": "400-1",
    "errors": {}
  }
}
```

### ❌ Error Response — Validation Error (422)

```
{
  "data": null,
  "meta": {
    "status": false,
    "message": "تکمیل گزینه otp الزامی است",
    "message_parameters": [],
    "message_code": "400-2",
    "errors": {
      "otp": [
        "تکمیل گزینه otp الزامی است"
      ]
    }
  }
}

```

### 🧪 Example using curl

```
curl --location '{base_url}/api/acl/auth/confirm_otp' \
--header 'Content-Type: application/json' \
--data '{
  "token": "your-login-step-token",
  "otp": "otp-code"
}'
```


## Forgot Password
### Request Otp For Change Password
This endpoint is used to request an OTP (One-Time Password) for changing the password.
### 📍 Endpoint
POST {base_url}/api/acl/auth/forgot_password
### 🧾 Headers
| Key           | Value                |
|---------------|----------------------|
| Content-Type  | application/json     |
### 📤 Request Body
```json
{
  "username": "your-username", 
  "mobile": "your-mobile-number"
}
```

### ✅ Success Response
```json
{
    "data": {
        "token": "6b1059f512b4fe9acd8bdb22351b0b51"
    },
    "meta": {
        "status": true,
        "message": "انجام شد",
        "message_parameters": [],
        "message_code": "200-1"
    }
}
```

### ❌ Error Response — Invalid or Expired Token (401)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "اطلاعات وارد شده صحیح نمی باشد",
        "message_parameters": [],
        "message_code": "400-1",
        "errors": {}
    }
}
```
### ❌ Error Response — Validation Error (422)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "تکمیل گزینه نام کاربری الزامی است",
        "message_parameters": [],
        "message_code": "400-2",
        "errors": {
            "username": [
                "تکمیل گزینه نام کاربری الزامی است"
            ]
        }
    }
}
```

### 🧪 Example using curl
```
curl --location '{base_url}/api/acl/auth/forgot_password' \
--header 'Content-Type: application/json' \
--data '{
    "username":"your-username",
    "mobile":"your-mobile-number"
}'
```

### Change Password By Token
This endpoint is used to change the password using the OTP received in the previous step.
### 📍 Endpoint
POST {base_url}/api/acl/auth/change_password_by_token
### 🧾 Headers
| Key           | Value                |
|---------------|----------------------|
| Content-Type  | application/json     |

### 📤 Request Body
```json
{
    "token":"token-from-forgot-password",
    "otp":"otp-code",
    "password":"new-password"
}
```
### ✅ Success Response
```json
{
    "data": null,
    "meta": {
        "status": true,
        "message": "انجام شد",
        "message_parameters": [],
        "message_code": "200-1"
    }
}
```
### ❌ Error Response — Invalid or Expired Token (401)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "اطلاعات وارد شده صحیح نمی باشد",
        "message_parameters": [],
        "message_code": "400-1",
        "errors": {}
    }
}
```
### ❌ Error Response — Validation Error (422)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "تکمیل گزینه گذرواژه الزامی است",
        "message_parameters": [],
        "message_code": "400-2",
        "errors": {
            "password": [
                "تکمیل گزینه گذرواژه الزامی است"
            ]
        }
    }
}
```
### 🧪 Example using curl
```
curl --location '{base_url}/api/acl/auth/change_password_by_token' \
--header 'Content-Type: application/json' \
--data '{
    "token":"token-from-forgot-password",
    "otp":"otp-code",
    "password":"new-password"
}'
```
## Logout
This endpoint is used to log out the user from the system.
### 📍 Endpoint
POST {base_url}/api/acl/auth/logout
### 🧾 Headers
| Key           | Value            |
|---------------|------------------|
| Content-Type  | application/json |
| Authorization | your-token       |
### ✅ Success Response
```json
{
    "data": null,
    "meta": {
        "status": true,
        "message": "انجام شد",
        "message_parameters": [],
        "message_code": "200-1"
    }
}
```
### ❌ Error Response — Invalid or Expired Token (401)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "اطلاعات وارد شده صحیح نمی باشد",
        "message_parameters": [],
        "message_code": "400-1",
        "errors": {}
    }
}
```
### 🧪 Example using curl
```
curl --location '{base_url}/api/acl/auth/logout' \
--header 'Content-Type: application/json' \
--header 'Authorization: your-token'
```
## Check Token
This endpoint is used to check the validity of the token.
### 📍 Endpoint
POST {base_url}/api/acl/auth/check_token
### 🧾 Headers
| Key           | Value            |
|---------------|------------------|
| Content-Type  | application/json |
| Authorization | your-token       |
### ✅ Success Response
```json
{
    "data": {
        "user_name": "ippanel",
        "user_id": 58745,
        "document_block": false,
        "is_reseller": true,
        "send_block": false,
        "name": "test"
    },
    "meta": {
        "status": true,
        "message": "انجام شد",
        "message_parameters": [],
        "message_code": "200-1"
    }
}
```
### ❌ Error Response — Invalid or Expired Token (401)
```json
{
    "data": null,
    "meta": {
        "status": false,
        "message": "اطلاعات وارد شده صحیح نمی باشد",
        "message_parameters": [],
        "message_code": "400-1",
        "errors": {}
    }
}
```
### 🧪 Example using curl
```
curl --location '{base_url}/api/acl/auth/check_token' \
--header 'Content-Type: application/json' \
--header 'Authorization: your-token'
```

